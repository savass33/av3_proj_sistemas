services:
  # 1. Frontend (React)
  - type: web
    name: livraria-frontend
    env: docker
    dockerContext: ./frontend
    dockerfilePath: ./frontend/Dockerfile
    plan: free
    envVars:
      # O Render não gera URL pública no build.
      # Você atualizará estes valores no Dashboard DEPOIS do deploy.
      - key: VITE_API_USERS
        value: "https://ms-usuarios-8nb7.onrender.com"
      - key: VITE_API_CATALOG
        value: "https://ms-catalogo-s348.onrender.com"
      - key: VITE_API_PAYMENT
        value: "https://ms-pagamento.onrender.com"
      - key: VITE_API_NOTIFICATION
        value: "https://ms-notificacao.onrender.com"

  # 2. Usuários (Porta 8081)
  - type: web
    name: ms-usuarios
    env: docker
    dockerContext: ./microservicos/usuarios
    dockerfilePath: ./microservicos/usuarios/Dockerfile
    plan: free
    envVars:
      - key: DB_HOST
        value: your-db-host.com  # Configure com seu banco MySQL/PostgreSQL
      - key: DB_USER
        value: your-db-user
      - key: DB_PASSWORD
        value: your-db-password

  # 3. Catálogo (Porta 8084)
  - type: web
    name: ms-catalogo
    env: docker
    dockerContext: ./microservicos/livros
    dockerfilePath: ./microservicos/livros/Dockerfile
    plan: free
    envVars:
      - key: DB_HOST
        value: your-db-host.com
      - key: DB_USER
        value: your-db-user
      - key: DB_PASSWORD
        value: your-db-password
      - key: USUARIOS_HOST
        fromService:
          type: web
          name: ms-usuarios
          property: host
      - key: PAGAMENTO_HOST
        fromService:
          type: web
          name: ms-pagamento
          property: host

  # 4. Pagamento (Porta 8082)
  - type: web
    name: ms-pagamento
    env: docker
    dockerContext: ./microservicos/pagamento
    dockerfilePath: ./microservicos/pagamento/Dockerfile
    plan: free
    envVars:
      - key: DB_HOST
        value: your-db-host.com
      - key: DB_USER
        value: your-db-user
      - key: DB_PASSWORD
        value: your-db-password
      - key: NOTIFICACAO_HOST
        fromService:
          type: web
          name: ms-notificacao
          property: host

  # 5. Notificação (Porta 8083)
  - type: web
    name: ms-notificacao
    env: docker
    dockerContext: ./microservicos/notificacao
    dockerfilePath: ./microservicos/notificacao/Dockerfile
    plan: free
    envVars:
      - key: DB_HOST
        value: your-db-host.com
      - key: DB_USER
        value: your-db-user
      - key: DB_PASSWORD
        value: your-db-password
      - key: USUARIOS_HOST
        fromService:
          type: web
          name: ms-usuarios
          property: host

  # 6. Pedidos (Porta 8085)
  - type: web
    name: ms-pedidos
    env: docker
    dockerContext: ./microservicos/pedidos
    dockerfilePath: ./microservicos/pedidos/Dockerfile
    plan: free
    envVars:
      - key: DB_HOST
        value: your-db-host.com
      - key: DB_USER
        value: your-db-user
      - key: DB_PASSWORD
        value: your-db-password
      - key: USUARIOS_HOST
        fromService:
          type: web
          name: ms-usuarios
          property: host
      - key: CATALOGO_HOST
        fromService:
          type: web
          name: ms-catalogo
          property: host